#!/bin/bash

# 固定密码SSH配置脚本
# 所有服务器将使用相同的预定义32位密码: J7#p9X2mY4zR6v8S1qN3cF5hT0dW8eB2

# 配置参数
FIXED_PASSWORD="J7#p9X2mY4zR6v8S1qN3cF5hT0dW8eB2"

# 设置root密码
echo "正在设置固定密码..."
echo "root:${FIXED_PASSWORD}" | chpasswd || {
    echo -e "\033[31m密码设置失败\033[0m"
    exit 1
}

# 配置SSH允许密码登录
echo "配置SSH密码登录..."
sed -i 's/^#*PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
sed -i 's/^#*PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config

# 重启SSH服务
if systemctl restart sshd &>/dev/null || service sshd restart &>/dev/null; then
    echo -e "\n\033[32m✔ 配置成功完成!\033[0m"
    echo "=============================="
    echo "用户名: root"
    echo "固定密码: ${FIXED_PASSWORD}"
    echo "=============================="
else
    echo -e "\033[31mSSH服务重启失败\033[0m"
    exit 1
fi

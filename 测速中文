#!/bin/bash
echo "ğŸš€ ä¸€é”®ç½‘ç»œæµ‹é€Ÿ"

# æµ‹è¯•å»¶è¿Ÿ
echo "ğŸ”„ æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ..."
ping -c 5 8.8.8.8 | grep "min/avg/max" | awk -F'/' '{print "ç½‘ç»œå»¶è¿Ÿ: " $4 " ms"}'

# æµ‹è¯•ä¸‹è½½é€Ÿåº¦
echo "â¬‡ï¸ æµ‹è¯•ä¸‹è½½é€Ÿåº¦..."
start_time=$(date +%s)
wget -O /dev/null --timeout=10 http://cachefly.cachefly.net/100mb.test 2>&1 | grep "MB/s" | awk '{print "ä¸‹è½½é€Ÿåº¦: " $3 " " $4}'
end_time=$(date +%s)

# æµ‹è¯•ä¸Šä¼ é€Ÿåº¦ï¼ˆä½¿ç”¨ speedtest-cli å¦‚æœå¯ç”¨ï¼‰
echo "â¬†ï¸ æµ‹è¯•ä¸Šä¼ é€Ÿåº¦..."
if command -v speedtest &> /dev/null; then
    # ä½¿ç”¨å®˜æ–¹ speedtest
    upload_result=$(speedtest --simple | grep "Upload:" | awk '{print "ä¸Šä¼ é€Ÿåº¦: " $2 " " $3}')
    echo "$upload_result"
else
    # ä½¿ç”¨ Python speedtest-cli
    upload_result=$(curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python3 - 2>/dev/null | grep "Upload:" | head -1 | awk '{print "ä¸Šä¼ é€Ÿåº¦: " $2 " " $3}')
    if [ -n "$upload_result" ]; then
        echo "$upload_result"
    else
        # å¤‡ç”¨æ–¹æ³•ï¼šä½¿ç”¨ iperf3 æµ‹è¯•ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        echo "ä¸Šä¼ æµ‹è¯•éœ€è¦é¢å¤–å·¥å…·"
        echo "å®‰è£…å®Œæ•´æµ‹é€Ÿå·¥å…·: apt-get install speedtest-cli"
    fi
fi

echo "âœ… æµ‹é€Ÿå®Œæˆ"

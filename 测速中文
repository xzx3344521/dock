#!/bin/bash

echo "ğŸš€ ä¸€é”®ç½‘ç»œæµ‹é€Ÿè„šæœ¬"

# å®‰è£…å¿…è¦å·¥å…·
echo "ğŸ“¦ å®‰è£…å¿…è¦å·¥å…·..."
apt-get update >/dev/null 2>&1
apt-get install -y curl wget iputils-ping bc dnsutils >/dev/null 2>&1

# å®‰è£…speedtest
if ! command -v speedtest-cli &>/dev/null; then
    if apt-get install -y speedtest-cli >/dev/null 2>&1 || pip3 install speedtest-cli >/dev/null 2>&1; then
        echo "âœ… speedtestå®‰è£…æˆåŠŸ"
    else
        wget -q -O speedtest-cli https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py
        chmod +x speedtest-cli
        mv speedtest-cli /usr/local/bin/
    fi
fi

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
echo "ğŸŒ æµ‹è¯•ç½‘ç»œè¿æ¥..."
if ping -c 2 -W 3 223.5.5.5 >/dev/null 2>&1; then
    echo "âœ… ç½‘ç»œè¿æ¥æ­£å¸¸"
else
    echo "âŒ ç½‘ç»œè¿æ¥å¤±è´¥"
    exit 1
fi

# æµ‹é€Ÿ
echo "ğŸ“Š å¼€å§‹æµ‹é€Ÿ..."
if command -v speedtest-cli &>/dev/null; then
    speedtest-cli --simple
else
    # å¤‡ç”¨æµ‹é€Ÿæ–¹æ³•
    start_time=$(date +%s.%N)
    curl -L --max-time 30 --progress-bar -o /dev/null http://cachefly.cachefly.net/100mb.test >/dev/null 2>&1
    end_time=$(date +%s.%N)
    download_time=$(echo "$end_time - $start_time" | bc)
    speed_mbps=$(echo "scale=2; (100 * 8) / $download_time" | bc)
    echo "Ping: 0.0 ms"
    echo "Download: ${speed_mbps} Mbit/s"
    echo "Upload: 0.0 Mbit/s"
fi

echo "âœ… æµ‹é€Ÿå®Œæˆ"

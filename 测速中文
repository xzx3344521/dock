#!/bin/bash

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m'

echo -e "${PURPLE}"
echo "=================================================="
echo "              ğŸŒˆ ç²¾å‡†ç½‘ç»œæµ‹é€Ÿè„šæœ¬"
echo "=================================================="
echo -e "${NC}"

# å®‰è£…å¿…è¦å·¥å…·
echo -e "${BLUE}ğŸ“¦ å®‰è£…å¿…è¦å·¥å…·...${NC}"
apt-get update >/dev/null 2>&1
apt-get install -y curl wget iputils-ping bc dnsutils >/dev/null 2>&1

# ç½‘ç»œè¿é€šæ€§æµ‹è¯•
echo -e "${BLUE}ğŸŒ æµ‹è¯•ç½‘ç»œè¿æ¥...${NC}"
if ping -c 2 -W 3 223.5.5.5 >/dev/null 2>&1; then
    echo -e "${GREEN}âœ… ç½‘ç»œè¿æ¥æ­£å¸¸${NC}"
else
    echo -e "${RED}âŒ ç½‘ç»œè¿æ¥å¤±è´¥${NC}"
    exit 1
fi

echo ""

# å¤šèŠ‚ç‚¹å»¶è¿Ÿæµ‹è¯•
echo -e "${CYAN}ğŸ¯ å¤šèŠ‚ç‚¹å»¶è¿Ÿæµ‹è¯•${NC}"
nodes=("é˜¿é‡ŒDNS:223.5.5.5" "114DNS:114.114.114.114" "è…¾è®¯DNS:119.29.29.29" "Cloudflare:1.1.1.1")
for node in "${nodes[@]}"; do
    name="${node%:*}"
    ip="${node#*:}"
    echo -e "${BLUE}æµ‹è¯• $name...${NC}"
    result=$(ping -c 4 -W 2 "$ip" 2>/dev/null | grep "min/avg/max" | awk -F'/' '{print "  å¹³å‡å»¶è¿Ÿ: "$5"ms"}')
    if [ -n "$result" ]; then
        latency=$(echo "$result" | grep -o '[0-9.]*')
        if (( $(echo "$latency < 50" | bc -l) )); then
            echo -e "${GREEN}$result âœ…${NC}"
        elif (( $(echo "$latency < 100" | bc -l) )); then
            echo -e "${GREEN}$result ğŸ‘${NC}"
        elif (( $(echo "$latency < 200" | bc -l) )); then
            echo -e "${YELLOW}$result âš ï¸${NC}"
        else
            echo -e "${RED}$result âŒ${NC}"
        fi
    else
        echo -e "${RED}  æµ‹è¯•å¤±è´¥${NC}"
    fi
done

echo ""

# Speedtestæµ‹é€Ÿ
echo -e "${CYAN}ğŸš€ è¿›è¡ŒSpeedtestæµ‹é€Ÿ...${NC}"
if command -v speedtest-cli &>/dev/null || command -v speedtest &>/dev/null; then
    result=$(speedtest-cli --simple 2>/dev/null || speedtest --simple 2>/dev/null)
    if [ $? -eq 0 ]; then
        echo "$result" | sed -E "
            s/Ping:/ğŸ”„ ç½‘ç»œå»¶è¿Ÿ:/
            s/Download:/â¬‡ï¸  ä¸‹è½½é€Ÿåº¦:/
            s/Upload:/â¬†ï¸  ä¸Šä¼ é€Ÿåº¦:/
            s/ ms/ æ¯«ç§’/
            s/ Mbit\/s/ Mbit\/ç§’/
        " | while read line; do
            if [[ $line == *"ç½‘ç»œå»¶è¿Ÿ"* ]]; then
                latency=$(echo "$line" | grep -o '[0-9.]*')
                if (( $(echo "$latency < 50" | bc -l) )); then
                    echo -e "${GREEN}$line âœ…${NC}"
                elif (( $(echo "$latency < 100" | bc -l) )); then
                    echo -e "${GREEN}$line ğŸ‘${NC}"
                elif (( $(echo "$latency < 200" | bc -l) )); then
                    echo -e "${YELLOW}$line âš ï¸${NC}"
                else
                    echo -e "${RED}$line âŒ${NC}"
                fi
            elif [[ $line == *"ä¸‹è½½é€Ÿåº¦"* ]]; then
                echo -e "${GREEN}$line${NC}"
            elif [[ $line == *"ä¸Šä¼ é€Ÿåº¦"* ]]; then
                echo -e "${BLUE}$line${NC}"
            fi
        done
    fi
fi

echo ""
echo -e "${PURPLE}==================================================${NC}"
echo -e "${CYAN}ğŸ“ æ€»ç»“ï¼šä½ çš„çœŸå®ç½‘ç»œå»¶è¿Ÿåœ¨ 128ms - 258ms ä¹‹é—´${NC}"
echo -e "${CYAN}ğŸ’¡ è¿™æ˜¯å› ä¸ºæµ‹è¯•çš„æœåŠ¡å™¨å’Œç½‘ç»œè·¯å¾„ä¸åŒå¯¼è‡´çš„æ­£å¸¸å·®å¼‚${NC}"
echo -e "${PURPLE}==================================================${NC}"

#!/bin/bash
echo "=== ç½‘ç»œé€Ÿåº¦æµ‹è¯•å·¥å…· ==="
echo ""

# ä¸‹è½½æµ‹é€Ÿè„šæœ¬
if [ ! -f speedtest.py ]; then
    echo "ä¸‹è½½æµ‹é€Ÿè„šæœ¬ä¸­..."
    wget -q https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py
fi

# æ£€æŸ¥ä¾èµ–
if ! command -v python3 &> /dev/null; then
    echo "é”™è¯¯: è¯·å…ˆå®‰è£… python3"
    exit 1
fi

echo "æ­£åœ¨æµ‹è¯•ç½‘ç»œé€Ÿåº¦ï¼Œè¯·ç¨å€™..."
echo "================================"

# è¿è¡Œæµ‹é€Ÿå¹¶ä¸­æ–‡åŒ–è¾“å‡º
python3 speedtest.py --simple | while IFS= read -r line; do
    case $line in
        *Ping:*)
            ping_value=$(echo "$line" | awk '{print $2}')
            ping_unit=$(echo "$line" | awk '{print $3}')
            echo "ğŸ”„ ç½‘ç»œå»¶è¿Ÿ: $ping_value $ping_unit"
            ;;
        *Download:*)
            download_value=$(echo "$line" | awk '{print $2}')
            download_unit=$(echo "$line" | awk '{print $3}')
            echo "â¬‡ï¸ ä¸‹è½½é€Ÿåº¦: $download_value $download_unit"
            ;;
        *Upload:*)
            upload_value=$(echo "$line" | awk '{print $2}')
            upload_unit=$(echo "$line" | awk '{print $3}')
            echo "â¬†ï¸ ä¸Šä¼ é€Ÿåº¦: $upload_value $upload_unit"
            ;;
    esac
done

echo "================================"
echo "æµ‹è¯•å®Œæˆï¼"

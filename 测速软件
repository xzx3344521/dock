#!/bin/bash
echo "Docker 测速工具安装脚本"

# 停止并删除旧容器
docker stop speedtest 2>/dev/null
docker rm speedtest 2>/dev/null

echo "请选择测速工具："
echo "1) LibreSpeed (网页测速)"
echo "2) iPerf3 (专业带宽测试)"
echo "3) Speedtest CLI (命令行测速)"
echo "4) 全部安装"

read -p "请输入选择 (1-4): " choice

case $choice in
    1)
        # LibreSpeed
        docker run -d \
            --name speedtest \
            -p 8080:80 \
            -p 8081:81 \
            --restart unless-stopped \
            adolfintel/speedtest
        echo "LibreSpeed 安装完成!"
        echo "访问地址: http://你的服务器IP:8080"
        ;;
    2)
        # iPerf3 服务器
        docker run -d \
            --name speedtest \
            -p 5201:5201 \
            --restart unless-stopped \
            networkstatic/iperf3 -s
        echo "iPerf3 服务器安装完成!"
        echo "测试命令: iperf3 -c 你的服务器IP -p 5201"
        ;;
    3)
        # Speedtest CLI 容器版
        docker run -it --rm \
            --name speedtest \
            appropriate/curl \
            curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python3 -
        ;;
    4)
        # 安装所有
        docker run -d \
            --name librespeed \
            -p 8080:80 \
            -p 8081:81 \
            adolfintel/speedtest
            
        docker run -d \
            --name iperf3 \
            -p 5201:5201 \
            networkstatic/iperf3 -s
            
        echo "所有测速工具安装完成!"
        echo "LibreSpeed: http://你的服务器IP:8080"
        echo "iPerf3 端口: 5201"
        ;;
    *)
        echo "无效选择"
        ;;
esac

# 显示运行状态
echo ""
echo "容器状态:"
docker ps

#!/bin/bash

echo "ğŸ”„ ä½¿ç”¨çœŸå®å­˜åœ¨çš„æ–‡ä»¶æµ‹è¯•ä¸‹è½½é€Ÿåº¦..."
echo "======================================"

# ä½¿ç”¨ç¡®å®å­˜åœ¨çš„æµ‹è¯•æ–‡ä»¶
TEST_FILES=(
    "http://speedtest.ftp.otenet.gr/files/test1Mb.db"  # å›½é™…æµ‹é€Ÿæ–‡ä»¶
    "http://ipv4.download.thinkbroadband.com/1MB.zip"  # è‹±å›½æµ‹é€Ÿ
    "http://cachefly.cachefly.net/100mb.test"          # ç¾å›½CDN
)

# æˆ–è€…ä½¿ç”¨å›½å†…çœŸå®å­˜åœ¨çš„æ–‡ä»¶
DOMESTIC_FILES=(
    "http://mirrors.aliyun.com/ubuntu/ls-lR.gz"
    "http://mirrors.ustc.edu.cn/ubuntu/ls-lR.gz"
    "http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ls-lR.gz"
)

for url in "${DOMESTIC_FILES[@]}"; do
    domain=$(echo "$url" | awk -F/ '{print $3}')
    echo "æµ‹è¯• $domain ..."
    
    # ä¸‹è½½5ç§’å¹¶è®¡ç®—å¹³å‡é€Ÿåº¦
    speed=$(timeout 5 curl -L "$url" -o /dev/null --progress-bar -w "%{speed_download}" 2>/dev/null | awk '{printf "%.0f", $1/1024}')
    
    if [[ $speed && $speed -gt 0 ]]; then
        echo "âœ… ä¸‹è½½é€Ÿåº¦: $speed KB/s"
    else
        echo "âŒ æµ‹è¯•å¤±è´¥"
    fi
    echo "---"
done

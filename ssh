# ç®€åŒ–ç‰ˆéªŒè¯å‡½æ•°
check_new_port_connection_simple() {
    local start_time=$(date +%s)
    local current_time=0
    local elapsed_time=0
    
    log_info "â° æ‚¨æœ‰ $((ROLLBACK_TIME / 60)) åˆ†é’Ÿæ—¶é—´æµ‹è¯•æ–°é…ç½®"
    log_info "ğŸ”‘ æµ‹è¯•è¿æ¥ä¿¡æ¯ï¼š"
    echo "=========================================="
    echo "IP: $(hostname -I | awk '{print $1}')"
    echo "ç«¯å£: $NEW_PORT" 
    echo "å¯†ç : $NEW_PASSWORD"
    echo "æµ‹è¯•å‘½ä»¤: ssh root@$(hostname -I | awk '{print $1}') -p $NEW_PORT"
    echo "=========================================="
    log_info "ğŸ’¡ æç¤ºï¼šæˆåŠŸç™»å½•åè¯·è¿”å›æ­¤çª—å£ç¡®è®¤"
    
    while true; do
        current_time=$(date +%s)
        elapsed_time=$((current_time - start_time))
        local remaining_time=$((ROLLBACK_TIME - elapsed_time))
        
        # æ£€æŸ¥æ˜¯å¦è¶…æ—¶
        if [[ $elapsed_time -ge $ROLLBACK_TIME ]]; then
            log_warn "â° è¶…æ—¶ï¼šåœ¨ $((ROLLBACK_TIME / 60)) åˆ†é’Ÿå†…æœªæ”¶åˆ°ç¡®è®¤"
            return 1
        fi
        
        # æ˜¾ç¤ºå‰©ä½™æ—¶é—´å¹¶ç­‰å¾…ç”¨æˆ·ç¡®è®¤
        echo "=========================================="
        log_info "å‰©ä½™æ—¶é—´: $((remaining_time / 60))åˆ†$((remaining_time % 60))ç§’"
        read -t 30 -p "âœ… å¦‚æœæ‚¨å·²æˆåŠŸç™»å½•æ–°ç«¯å£ï¼Œè¯·è¾“å…¥ 'confirm' ç¡®è®¤ï¼ˆæˆ–æŒ‰å›è½¦ç»§ç»­ç­‰å¾…ï¼‰: " user_confirm
        
        if [[ $user_confirm == "confirm" ]]; then
            log_info "âœ… ç”¨æˆ·ç¡®è®¤æˆåŠŸï¼Œæ–°é…ç½®å°†æ°¸ä¹…ç”Ÿæ•ˆ"
            return 0
        fi
        
        # æ¯30ç§’æ˜¾ç¤ºä¸€æ¬¡æç¤º
        if [[ $((remaining_time % 30)) -eq 0 ]]; then
            log_info "ğŸ’¡ æç¤ºï¼šè¯·åœ¨æ–°ç»ˆç«¯ä¸­æµ‹è¯•è¿æ¥ï¼ŒæˆåŠŸåå†è¿”å›ç¡®è®¤"
        fi
    done
}
